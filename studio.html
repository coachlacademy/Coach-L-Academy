<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach L Radio â€“ Host Studio</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { width:100%; height:100%; font-family:'Segoe UI', sans-serif; background:#000; overflow:hidden; }

  /* ===== HEADER + NOTICE ===== */
  .top-ui { position: absolute; top:0; left:0; width:100%; z-index:10; pointer-events:none; }
  header { padding: 15px 25px; background: rgba(0,0,0,0.6); display:flex; justify-content:space-between; align-items:center; color:#fff; pointer-events:auto; }
  header h1 { font-size: 1.1rem; letter-spacing:1px; }
  .badge { background:#e53935; padding:6px 12px; border-radius:20px; font-size:0.75rem; font-weight:bold; text-transform:uppercase; }

  /* Instructions notice with two colors */
  .notice { padding:12px; text-align:center; font-size:0.85rem; pointer-events:auto; }
  .notice span:first-child { color:#ff69b4; font-weight:bold; } /* pink */
  .notice span:last-child { color:#b36eb7; font-weight:bold; } /* purple */

  /* Guest notification */
  #guestAlert { position: fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(32,178,170,0.95); color:#fff; padding:12px 25px; border-radius:30px; font-weight:bold; z-index:20; opacity:0; transition:opacity 0.5s; box-shadow:0 4px 12px rgba(0,0,0,0.4); }

  /* Exit Button */
  #exitBtn { position: fixed; bottom:20px; right:20px; background:#ff3366; color:#fff; padding:10px 18px; border-radius:30px; font-weight:bold; cursor:pointer; z-index:20; opacity:0.85; transition:opacity 0.3s; }
  #exitBtn:hover { opacity:1; }

  /* WEB DJ */
  #webdj { position:absolute; top:0; left:0; width:100vw; height:75vh; border:none; z-index:1; }

  /* Jitsi iframe */
  #jitsiFrame { position:absolute; bottom:0; left:0; width:100%; height:25vh; border:none; z-index:2; display:none; }

  /* Fade animations */
  .fade-in { animation: fadeIn 1s forwards; }
  .fade-out { animation: fadeOut 1s forwards; }

  @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  @keyframes fadeOut { from {opacity:1;} to {opacity:0;} }
</style>
</head>
<body>

<div class="top-ui" id="topUI">
  <header>
    <h1>ðŸŽ™ Coach L Radio â€“ Host Studio</h1>
    <div class="badge">Host Only</div>
  </header>
  <div class="notice">
    <span>AutoDJ will pause</span> and <span>your microphone will go live</span> when connected.
  </div>
</div>

<iframe id="webdj" src="https://coach-l-radio.duckdns.org/public/coach-l-radio/dj" allow="microphone; autoplay; fullscreen" allowfullscreen></iframe>

<!-- Exit Button -->
<button id="exitBtn" onclick="exitStudio()">Exit Studio</button>

<!-- Guest Alert -->
<div id="guestAlert">Guest Incoming!</div>

<!-- Jitsi iframe -->
<iframe id="jitsiFrame" allow="camera; microphone; fullscreen" allowfullscreen></iframe>

<script>
const webdj = document.getElementById("webdj");
const topUI = document.getElementById("topUI");
const notice = topUI.querySelector(".notice");
const exitBtn = document.getElementById("exitBtn");
const jitsiFrame = document.getElementById("jitsiFrame");
const guestAlert = document.getElementById("guestAlert");

let wakeLock = null;
async function requestWakeLock() {
  try { wakeLock = await navigator.wakeLock?.request('screen'); }
  catch(err){ console.warn('WakeLock failed:', err); }
}
async function releaseWakeLock() {
  if(wakeLock){ await wakeLock.release(); wakeLock=null; }
}

// Fade in instructions on load, then fade out after 4 seconds
window.addEventListener("load", () => {
  topUI.style.opacity = 1;
  notice.classList.add("fade-in");
  setTimeout(() => {
    notice.classList.remove("fade-in");
    notice.classList.add("fade-out");
  }, 4000);
});

// Hide top UI when WebDJ fully loaded for clean studio
webdj.addEventListener("load", async () => {
  setTimeout(async () => {
    exitBtn.style.display="block";

    // Fullscreen
    const elem=document.documentElement;
    if(elem.requestFullscreen) elem.requestFullscreen();
    else if(elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
    else if(elem.msRequestFullscreen) elem.msRequestFullscreen();

    await requestWakeLock();

    // Show guest Jitsi iframe in same window with fixed room
    showGuestCall();
  }, 1200);
});

// Exit Studio
function exitStudio() {
  releaseWakeLock();
  if(document.fullscreenElement){ document.exitFullscreen?.(); }
  window.location.href = "index.html";
}

// Show guest Jitsi embedded and persist same room
function showGuestCall() {
  guestAlert.style.opacity = 1;
  setTimeout(()=>{ guestAlert.style.opacity = 0; }, 2500);

  jitsiFrame.src = "https://meet.jit.si/CoachLGuestRoom#config.startWithAudioMuted=false&config.startWithVideoMuted=false&interfaceConfig.DISABLE_VIDEO_BACKGROUND=true";
  jitsiFrame.style.display = "block";
}
</script>

</body>
</html>