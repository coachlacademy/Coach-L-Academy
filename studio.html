<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Coach L Radio â€“ Host Studio</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { width:100%; height:100%; font-family:'Segoe UI', sans-serif; background:#000; overflow:hidden; }

  /* ===== TOP UI ===== */
  .top-ui { position:absolute; top:0; left:0; width:100%; z-index:10; transition: all 0.6s ease; }
  .top-ui.hidden { opacity:0; transform:translateY(-100%); pointer-events:none; }

  header { padding: 15px 25px; background: rgba(0,0,0,0.6); display:flex; justify-content:space-between; align-items:center; color:#fff; }
  header h1 { font-size: 1.1rem; letter-spacing:1px; }
  .badge { background:#e53935; padding:6px 12px; border-radius:20px; font-size:0.75rem; font-weight:bold; text-transform:uppercase; }

  /* Instructions notice */
  .notice { padding:12px; text-align:center; font-size:0.85rem; }
  .notice span:first-child { color:#ff69b4; font-weight:bold; }
  .notice span:last-child { color:#b36eb7; font-weight:bold; }

  /* Guest alert */
  #guestAlert { position: fixed; top:20px; left:50%; transform:translateX(-50%); background:rgba(32,178,170,0.95); color:#fff; padding:12px 25px; border-radius:30px; font-weight:bold; z-index:20; opacity:0; transition:opacity 0.5s; box-shadow:0 4px 12px rgba(0,0,0,0.4); }

  /* Exit Button */
  #exitBtn { position: fixed; bottom:20px; right:20px; background:#ff3366; color:#fff; padding:10px 18px; border-radius:30px; font-weight:bold; cursor:pointer; z-index:20; opacity:0.85; transition:opacity 0.3s; }
  #exitBtn:hover { opacity:1; }

  /* WEB DJ */
  #webdj { position:absolute; top:0; left:0; width:100vw; height:75vh; border:none; z-index:1; }

  /* Jitsi iframe */
  #jitsiFrame { position:absolute; bottom:0; left:0; width:100%; height:25vh; border:none; z-index:2; display:none; }
</style>
</head>
<body>

<div class="top-ui" id="topUI">
  <header>
    <h1>ðŸŽ™ Coach L Radio â€“ Host Studio</h1>
    <div class="badge">Host Only</div>
  </header>
  <div class="notice">
    <span>AutoDJ will pause</span> and <span>your microphone will go live</span> when connected.
  </div>
</div>

<iframe id="webdj" src="https://coach-l-radio.duckdns.org/public/coach-l-radio/dj" allow="microphone; autoplay; fullscreen" allowfullscreen></iframe>

<button id="exitBtn" onclick="exitStudio()">Exit Studio</button>

<div id="guestAlert">Guest Incoming!</div>

<iframe id="jitsiFrame" allow="camera; microphone; fullscreen" allowfullscreen></iframe>

<script>
const webdj = document.getElementById("webdj");
const topUI = document.getElementById("topUI");
const guestAlert = document.getElementById("guestAlert");
const jitsiFrame = document.getElementById("jitsiFrame");

let wakeLock = null;
async function requestWakeLock() {
  try { wakeLock = await navigator.wakeLock?.request('screen'); }
  catch(err){ console.warn('WakeLock failed:', err); }
}
async function releaseWakeLock() {
  if(wakeLock){ await wakeLock.release(); wakeLock=null; }
}

// Fade out top UI after 4 seconds
window.addEventListener("load", () => {
  setTimeout(() => { topUI.classList.add("hidden"); }, 4000);
});

// Fullscreen WebDJ when loaded
webdj.addEventListener("load", async () => {
  document.getElementById("exitBtn").style.display="block";

  const elem=document.documentElement;
  if(elem.requestFullscreen) elem.requestFullscreen();
  else if(elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
  else if(elem.msRequestFullscreen) elem.msRequestFullscreen();

  await requestWakeLock();
});

// Exit Studio
function exitStudio() {
  releaseWakeLock();
  if(document.fullscreenElement){ document.exitFullscreen?.(); }
  window.location.href = "index.html";
}

// Trigger Guest connection manually when they join
function guestConnected() {
  guestAlert.style.opacity = 1;
  setTimeout(()=>{ guestAlert.style.opacity = 0; }, 2500);

  jitsiFrame.src = "https://meet.jit.si/CoachLGuestRoom#config.startWithAudioMuted=false&config.startWithVideoMuted=false&interfaceConfig.DISABLE_VIDEO_BACKGROUND=true";
  jitsiFrame.style.display = "block";
}

// Example: Call guestConnected() when your backend signals a guest is joining
// guestConnected();
</script>

</body>
</html>